###############################################################################
#                                                                             #
# Calypsi ISO C compiler for 65816                                version 5.2 #
#                                                       24/Feb/2024  16:03:27 #
# Command line: --core=65816 --code-model=large --data-model=large -D DEBUG   #
#               --target=Foenix -O2 --speed --list-file=obj/pmalloc.lst       #
#               -I/c/Program Files (x86)/Calypsi-65816/contrib/Foenix-SDK/include #
#               -o obj/pmalloc.o src/pmalloc.c                                #
#                                                                             #
###############################################################################

    \ 000000                      .rtmodel version,"1"
    \ 000000                      .rtmodel codeModel,"large"
    \ 000000                      .rtmodel dataModel,"large"
    \ 000000                      .rtmodel core,"65816"
    \ 000000                      .rtmodel huge,"0"
    \ 000000                      .rtmodel doubleSize,"32"
    \ 000000                      .rtmodel target,"foenix"
    \ 000000                      .extern _Dp
    \ 000000                      .extern _Vfp
    \ 000000                      .extern printf
0001                  //
0002                  // pmalloc - A Heap based memory manager
0003                  //
0004                  // Author: Tom Cully <mail@tomcully.com>
0005                  // Date: 10th Dec 2022
0006                  //
0007                  // pmalloc can be used to manage memory using a familiar malloc/free pattern in embedded 
0008                  // systems, or to manage sub-allocation within an area of memory given by the OS.
0009                  //
0010                  // To get started, call pmalloc_addblock with the address and size of the memory to be used for 
0011                  // allocation.
0012                  //
0013                  
0014                  #include "pmalloc.h"
0015                  
0016                  #ifdef DEBUG
0017                  	#include <stdio.h>
0018                  #endif
0019                  
0020                  void pmalloc_init(pmalloc_t *pm) {
    \ 000000                      .section farcode,text
    \ 000000                      .public pmalloc_init
    \ 000000          pmalloc_init:
    \ 000000 d4..                 pei     dp:.tiny (_Dp+8)
    \ 000002 d4..                 pei     dp:.tiny (_Dp+10)
    \ 000004 a5..                 lda     dp:.tiny _Dp
    \ 000006 22......             jsl     long:`?L159`
0021                  	#ifdef DEBUG
0022                  		printf("pmalloc: DEBUG Enabled\r");
    \ 00000a a9....               lda     ##.word0 `_StringLiteral_[112,109,97,108,108,111,99,58,32,68,69,66,85,71,32,69,110,97,98,108,101,100,13]`
    \ 00000d 85..                 sta     dp:.tiny _Dp
    \ 00000f a9....               lda     ##.word2 `_StringLiteral_[112,109,97,108,108,111,99,58,32,68,69,66,85,71,32,69,110,97,98,108,101,100,13]`
    \ 000012 85..                 sta     dp:.tiny (_Dp+2)
    \ 000014 22......             jsl     long:printf
0023                  	#endif
0024                  
0025                  	pm->available = NULL;
    \ 000018 a90000               lda     ##0
    \ 00001b 87..                 sta     [.tiny (_Dp+8)]
    \ 00001d a00200               ldy     ##2
    \ 000020 97..                 sta     [.tiny (_Dp+8)],y
0026                  	pm->assigned = NULL;
0027                  	pm->freemem = 0;
0028                  	pm->totalmem = 0;
0029                  	pm->totalnodes = 0;
    \ 000022 22......             jsl     long:`?L177`
    \ 000026 a00800               ldy     ##8
    \ 000029 97..                 sta     [.tiny (_Dp+8)],y
    \ 00002b a00a00               ldy     ##10
    \ 00002e 97..                 sta     [.tiny (_Dp+8)],y
    \ 000030 a00c00               ldy     ##12
    \ 000033 97..                 sta     [.tiny (_Dp+8)],y
    \ 000035 a00e00               ldy     ##14
    \ 000038 97..                 sta     [.tiny (_Dp+8)],y
    \ 00003a a01000               ldy     ##16
    \ 00003d 97..                 sta     [.tiny (_Dp+8)],y
    \ 00003f a01200               ldy     ##18
    \ 000042 97..                 sta     [.tiny (_Dp+8)],y
    \ 000044          `?L3`:
0030                  }
    \ 000044 7a                   ply
    \ 000045 84..                 sty     dp:.tiny (_Dp+10)
    \ 000047 7a                   ply
    \ 000048 84..                 sty     dp:.tiny (_Dp+8)
    \ 00004a 6b                   rtl
0031                  
0032                  void pmalloc_addblock(pmalloc_t *pm, void __far *ptr, uint32_t size)
0033                  {
    \ 000000                      .section farcode,text
    \ 000000                      .public pmalloc_addblock
    \ 000000          pmalloc_addblock:
    \ 000000 d4..                 pei     dp:.tiny (_Dp+8)
    \ 000002 d4..                 pei     dp:.tiny (_Dp+10)
    \ 000004 d4..                 pei     dp:.tiny (_Dp+12)
    \ 000006 d4..                 pei     dp:.tiny (_Dp+14)
    \ 000008 86..                 stx     dp:.tiny (_Dp+14)
    \ 00000a 85..                 sta     dp:.tiny (_Dp+12)
    \ 00000c a5..                 lda     dp:.tiny _Dp
    \ 00000e 22......             jsl     long:`?L159`
0034                  	// Get the usable size of the block
0035                  	((pmalloc_item_t __far *)ptr)->size = size - sizeof(pmalloc_item_t);
    \ 000012 a5..                 lda     dp:.tiny (_Dp+12)
    \ 000014 38                   sec
    \ 000015 e90a00               sbc     ##10
    \ 000018 a00800               ldy     ##8
    \ 00001b 97..                 sta     [.tiny (_Dp+4)],y
0036                  
0037                  	// Update freemem and totalmem
0038                  	pm->freemem += ((pmalloc_item_t __far *)ptr)->size;
    \ 00001d a00a00               ldy     ##10
    \ 000020 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000022 aa                   tax
    \ 000023 a00800               ldy     ##8
    \ 000026 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000028 da                   phx
    \ 000029 48                   pha
    \ 00002a b7..                 lda     [.tiny (_Dp+4)],y
    \ 00002c 85..                 sta     dp:.tiny _Dp
    \ 00002e 68                   pla
    \ 00002f fa                   plx
    \ 000030 18                   clc
    \ 000031 65..                 adc     dp:.tiny _Dp
    \ 000033 9001                 bcc     `?L103`
    \ 000035 e8                   inx
    \ 000036          `?L103`:
    \ 000036 97..                 sta     [.tiny (_Dp+8)],y
    \ 000038 8a                   txa
    \ 000039 a00a00               ldy     ##10
    \ 00003c 97..                 sta     [.tiny (_Dp+8)],y
0039                  	pm->totalmem += pm->freemem;
    \ 00003e 18                   clc
    \ 00003f a00c00               ldy     ##12
    \ 000042 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000044 a00800               ldy     ##8
    \ 000047 77..                 adc     [.tiny (_Dp+8)],y
    \ 000049 48                   pha
    \ 00004a a00e00               ldy     ##14
    \ 00004d b7..                 lda     [.tiny (_Dp+8)],y
    \ 00004f a00a00               ldy     ##10
    \ 000052 77..                 adc     [.tiny (_Dp+8)],y
    \ 000054 aa                   tax
    \ 000055 68                   pla
    \ 000056 a00c00               ldy     ##12
    \ 000059 97..                 sta     [.tiny (_Dp+8)],y
    \ 00005b 8a                   txa
    \ 00005c a00e00               ldy     ##14
    \ 00005f 97..                 sta     [.tiny (_Dp+8)],y
0040                  
0041                  	// Add it to the available heap, update totalnodes
0042                  	pmalloc_item_insert(&pm->available, ptr);
    \ 000061 a5..                 lda     dp:.tiny (_Dp+8)
    \ 000063 85..                 sta     dp:.tiny _Dp
    \ 000065 a5..                 lda     dp:.tiny (_Dp+10)
    \ 000067 85..                 sta     dp:.tiny (_Dp+2)
    \ 000069 22......             jsl     long:pmalloc_item_insert
0043                  	pm->totalnodes++;
    \ 00006d a01200               ldy     ##18
    \ 000070 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000072 aa                   tax
    \ 000073 a01000               ldy     ##16
    \ 000076 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000078 1a                   inc     a
    \ 000079 d001                 bne     `?L106`
    \ 00007b e8                   inx
    \ 00007c          `?L106`:
    \ 00007c 97..                 sta     [.tiny (_Dp+8)],y
    \ 00007e 8a                   txa
    \ 00007f a01200               ldy     ##18
    \ 000082 97..                 sta     [.tiny (_Dp+8)],y
    \ 000084          `?L6`:
0044                  }
    \ 000084 7a                   ply
    \ 000085 84..                 sty     dp:.tiny (_Dp+14)
    \ 000087 7a                   ply
    \ 000088 84..                 sty     dp:.tiny (_Dp+12)
    \ 00008a 5c......             jmp     long:`?L3`
0045                  
0046                  void __far *pmalloc_malloc(pmalloc_t *pm, uint16_t size)
0047                  {
    \ 000000                      .section farcode,text
    \ 000000                      .public pmalloc_malloc
    \ 000000          pmalloc_malloc:
    \ 000000 d4..                 pei     dp:.tiny (_Dp+8)
    \ 000002 d4..                 pei     dp:.tiny (_Dp+10)
    \ 000004 d4..                 pei     dp:.tiny (_Dp+12)
    \ 000006 d4..                 pei     dp:.tiny (_Dp+14)
    \ 000008 5a                   phy
    \ 000009 5a                   phy
    \ 00000a 5a                   phy
    \ 00000b 8305                 sta     5,s
    \ 00000d a5..                 lda     dp:.tiny _Dp
    \ 00000f 85..                 sta     dp:.tiny (_Dp+12)
    \ 000011 a5..                 lda     dp:.tiny (_Dp+2)
    \ 000013 85..                 sta     dp:.tiny (_Dp+14)
0048                  	// Find a suitable block
0049                  	pmalloc_item_t __far *current = pm->available;
    \ 000015 a00200               ldy     ##2
    \ 000018 b7..                 lda     [.tiny (_Dp+12)],y
    \ 00001a 85..                 sta     dp:.tiny (_Dp+10)
    \ 00001c a7..                 lda     [.tiny (_Dp+12)]
    \ 00001e 85..                 sta     dp:.tiny (_Dp+8)
    \ 000020          `?L10`:
0050                  	while(current != NULL && current->size < size) current = current->next;
    \ 000020 a5..                 lda     dp:.tiny (_Dp+8)
    \ 000022 05..                 ora     dp:.tiny (_Dp+10)
    \ 000024 f012                 beq     `?L11`
    \ 000026 a00800               ldy     ##8
    \ 000029 b7..                 lda     [.tiny (_Dp+8)],y
    \ 00002b c305                 cmp     5,s
    \ 00002d b009                 bcs     `?L11`
    \ 00002f a00600               ldy     ##6
    \ 000032 22......             jsl     long:`?L157`
    \ 000036 80e8                 bra     `?L10`
    \ 000038          `?L11`:
0051                  
0052                  	// If there's nothing suitable, we're either out of memory or fragged.
0053                  	if(current == NULL) return NULL;
    \ 000038 a5..                 lda     dp:.tiny (_Dp+8)
    \ 00003a 05..                 ora     dp:.tiny (_Dp+10)
    \ 00003c d007                 bne     `?L14`
    \ 00003e a90000               lda     ##0
    \ 000041 aa                   tax
    \ 000042 4c....               jmp     .kbank `?L9`
    \ 000045          `?L14`:
0054                  
0055                  	// Remove it from pm->available
0056                  	pmalloc_item_remove(&pm->available, current);
    \ 000045 22......             jsl     long:`?L156`
    \ 000049 22......             jsl     long:pmalloc_item_remove
0057                  
0058                  	// Add to pm->assigned
0059                  	pmalloc_item_insert(&pm->assigned, current);
    \ 00004d 22......             jsl     long:`?L156`
    \ 000051 18                   clc
    \ 000052 a5..                 lda     dp:.tiny _Dp
    \ 000054 690400               adc     ##4
    \ 000057 85..                 sta     dp:.tiny _Dp
    \ 000059 22......             jsl     long:pmalloc_item_insert
0060                  
0061                  	// If it's not the exact size..
0062                  	if(current->size != size) {
    \ 00005d a00800               ldy     ##8
    \ 000060 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000062 c305                 cmp     5,s
    \ 000064 d003                 bne     `?L232`
    \ 000066 4c....               jmp     .kbank `?L18`
    \ 000069          `?L232`:
0063                  		// Add a free block that's the remainder size
0064                  		pmalloc_item_t __far *newfree = (pmalloc_item_t __far *)((char __far *)current + sizeof(pmalloc_item_t) + size);
    \ 000069 a6..                 ldx     dp:.tiny (_Dp+10)
    \ 00006b a5..                 lda     dp:.tiny (_Dp+8)
    \ 00006d 18                   clc
    \ 00006e 690a00               adc     ##10
    \ 000071 18                   clc
    \ 000072 6305                 adc     5,s
    \ 000074 8301                 sta     1,s
    \ 000076 8a                   txa
    \ 000077 8303                 sta     3,s
0065                  		newfree->size = current->size - sizeof(pmalloc_item_t) - size;
    \ 000079 b7..                 lda     [.tiny (_Dp+8)],y
    \ 00007b 38                   sec
    \ 00007c e90a00               sbc     ##10
    \ 00007f 38                   sec
    \ 000080 e305                 sbc     5,s
    \ 000082 48                   pha
    \ 000083 a305                 lda     5,s
    \ 000085 85..                 sta     dp:.tiny (_Dp+2)
    \ 000087 a303                 lda     3,s
    \ 000089 85..                 sta     dp:.tiny _Dp
    \ 00008b 68                   pla
    \ 00008c 97..                 sta     [.tiny _Dp],y
0066                  		newfree->next = current->next;
    \ 00008e a303                 lda     3,s
    \ 000090 85..                 sta     dp:.tiny (_Dp+2)
    \ 000092 a301                 lda     1,s
    \ 000094 85..                 sta     dp:.tiny _Dp
    \ 000096 a00400               ldy     ##4
    \ 000099 b7..                 lda     [.tiny (_Dp+8)],y
    \ 00009b 97..                 sta     [.tiny _Dp],y
    \ 00009d a00600               ldy     ##6
    \ 0000a0 b7..                 lda     [.tiny (_Dp+8)],y
    \ 0000a2 97..                 sta     [.tiny _Dp],y
0067                  		current->next = NULL;
    \ 0000a4 a90000               lda     ##0
0068                  		
0069                  		// Change pm->assigned size
0070                  		current->size = size;
0071                  		pmalloc_item_insert(&pm->available, newfree);
    \ 0000a7 22......             jsl     long:`?L177`
    \ 0000ab a305                 lda     5,s
    \ 0000ad a00800               ldy     ##8
    \ 0000b0 97..                 sta     [.tiny (_Dp+8)],y
    \ 0000b2 22......             jsl     long:`?L178`
    \ 0000b6 85..                 sta     dp:.tiny _Dp
    \ 0000b8 a5..                 lda     dp:.tiny (_Dp+14)
    \ 0000ba 85..                 sta     dp:.tiny (_Dp+2)
    \ 0000bc 22......             jsl     long:pmalloc_item_insert
0072                  
0073                  		// We've lost a bit of overhead making the new node
0074                  		pm->freemem -= sizeof(pmalloc_item_t);
    \ 0000c0 22......             jsl     long:`?L166`
    \ 0000c4 38                   sec
    \ 0000c5 e90a00               sbc     ##10
    \ 0000c8 b001                 bcs     `?L111`
    \ 0000ca ca                   dex
    \ 0000cb          `?L111`:
    \ 0000cb 97..                 sta     [.tiny (_Dp+12)],y
    \ 0000cd 8a                   txa
    \ 0000ce a00a00               ldy     ##10
    \ 0000d1 97..                 sta     [.tiny (_Dp+12)],y
0075                  		pm->totalnodes++;
    \ 0000d3 a01200               ldy     ##18
    \ 0000d6 b7..                 lda     [.tiny (_Dp+12)],y
    \ 0000d8 aa                   tax
    \ 0000d9 a01000               ldy     ##16
    \ 0000dc b7..                 lda     [.tiny (_Dp+12)],y
    \ 0000de 1a                   inc     a
    \ 0000df d001                 bne     `?L113`
    \ 0000e1 e8                   inx
    \ 0000e2          `?L113`:
    \ 0000e2 97..                 sta     [.tiny (_Dp+12)],y
    \ 0000e4 8a                   txa
    \ 0000e5 a01200               ldy     ##18
    \ 0000e8 97..                 sta     [.tiny (_Dp+12)],y
0076                  
0077                  		// Merge around newfree
0078                  		pmalloc_merge(pm, newfree);
    \ 0000ea 22......             jsl     long:`?L178`
    \ 0000ee 85..                 sta     dp:.tiny _Dp
    \ 0000f0 a5..                 lda     dp:.tiny (_Dp+14)
    \ 0000f2 85..                 sta     dp:.tiny (_Dp+2)
    \ 0000f4 22......             jsl     long:pmalloc_merge
    \ 0000f8          `?L18`:
0079                  	}
0080                  
0081                  	// Reduce the amount of free memory
0082                  	pm->freemem -= current->size;
    \ 0000f8 22......             jsl     long:`?L166`
    \ 0000fc da                   phx
    \ 0000fd 48                   pha
    \ 0000fe b7..                 lda     [.tiny (_Dp+8)],y
    \ 000100 85..                 sta     dp:.tiny _Dp
    \ 000102 68                   pla
    \ 000103 fa                   plx
    \ 000104 38                   sec
    \ 000105 e5..                 sbc     dp:.tiny _Dp
    \ 000107 b001                 bcs     `?L116`
    \ 000109 ca                   dex
    \ 00010a          `?L116`:
    \ 00010a 97..                 sta     [.tiny (_Dp+12)],y
    \ 00010c 8a                   txa
    \ 00010d a00a00               ldy     ##10
    \ 000110 97..                 sta     [.tiny (_Dp+12)],y
0083                  
0084                  	// Return the user memory
0085                  	return ((char __far *)current) + sizeof(pmalloc_item_t);
    \ 000112 a6..                 ldx     dp:.tiny (_Dp+10)
    \ 000114 a5..                 lda     dp:.tiny (_Dp+8)
    \ 000116 18                   clc
    \ 000117 690a00               adc     ##10
    \ 00011a          `?L9`:
0086                  }
    \ 00011a 7a                   ply
    \ 00011b 7a                   ply
    \ 00011c 7a                   ply
    \ 00011d 5c......             jmp     long:`?L6`
0087                  
0088                  void pmalloc_free(pmalloc_t *pm, void __far *ptr)
0089                  {
    \ 000000                      .section farcode,text
    \ 000000                      .public pmalloc_free
    \ 000000          pmalloc_free:
    \ 000000 d4..                 pei     dp:.tiny (_Dp+8)
    \ 000002 d4..                 pei     dp:.tiny (_Dp+10)
    \ 000004 d4..                 pei     dp:.tiny (_Dp+12)
    \ 000006 d4..                 pei     dp:.tiny (_Dp+14)
    \ 000008 5a                   phy
    \ 000009 a5..                 lda     dp:.tiny _Dp
    \ 00000b 85..                 sta     dp:.tiny (_Dp+12)
    \ 00000d a5..                 lda     dp:.tiny (_Dp+2)
    \ 00000f 85..                 sta     dp:.tiny (_Dp+14)
0090                  	// Match stdlib free() NULL interface
0091                  	if(ptr == NULL) return;
    \ 000011 a5..                 lda     dp:.tiny (_Dp+4)
    \ 000013 05..                 ora     dp:.tiny (_Dp+6)
    \ 000015 f076                 beq     `?L23`
0092                  
0093                  	// Get the node of this memory
0094                  	pmalloc_item_t __far *node = (pmalloc_item_t __far *)(((char __far *)ptr) - sizeof(pmalloc_item_t));
    \ 000017 a5..                 lda     dp:.tiny (_Dp+4)
    \ 000019 85..                 sta     dp:.tiny (_Dp+8)
    \ 00001b a5..                 lda     dp:.tiny (_Dp+6)
    \ 00001d 85..                 sta     dp:.tiny (_Dp+10)
    \ 00001f 38                   sec
    \ 000020 a5..                 lda     dp:.tiny (_Dp+8)
    \ 000022 e90a00               sbc     ##10
    \ 000025 85..                 sta     dp:.tiny (_Dp+8)
0095                  	#ifdef DEBUG
0096                  	printf("ptr  = %p\r", ptr);
    \ 000027 a5..                 lda     dp:.tiny (_Dp+6)
    \ 000029 48                   pha
    \ 00002a a5..                 lda     dp:.tiny (_Dp+4)
    \ 00002c 48                   pha
    \ 00002d a9....               lda     ##.word0 `_StringLiteral_[112,116,114,32,32,61,32,37,112,13]`
    \ 000030 85..                 sta     dp:.tiny _Dp
    \ 000032 a9....               lda     ##.word2 `_StringLiteral_[112,116,114,32,32,61,32,37,112,13]`
    \ 000035 22......             jsl     long:`?L167`
    \ 000039 8305                 sta     5,s
0097                  	printf("node = %p\r", node);
    \ 00003b 68                   pla
    \ 00003c 68                   pla
    \ 00003d a5..                 lda     dp:.tiny (_Dp+10)
    \ 00003f 48                   pha
    \ 000040 a5..                 lda     dp:.tiny (_Dp+8)
    \ 000042 48                   pha
    \ 000043 a9....               lda     ##.word0 `_StringLiteral_[110,111,100,101,32,61,32,37,112,13]`
    \ 000046 85..                 sta     dp:.tiny _Dp
    \ 000048 a9....               lda     ##.word2 `_StringLiteral_[110,111,100,101,32,61,32,37,112,13]`
    \ 00004b 22......             jsl     long:`?L167`
    \ 00004f 8305                 sta     5,s
0098                  	#endif
0099                  
0100                  	// Remove it from pm->assigned
0101                  	pmalloc_item_remove(&pm->assigned, node);
    \ 000051 68                   pla
    \ 000052 68                   pla
    \ 000053 22......             jsl     long:`?L156`
    \ 000057 18                   clc
    \ 000058 a5..                 lda     dp:.tiny _Dp
    \ 00005a 690400               adc     ##4
    \ 00005d 85..                 sta     dp:.tiny _Dp
    \ 00005f 22......             jsl     long:pmalloc_item_remove
0102                  
0103                  	pm->freemem += node->size;
    \ 000063 22......             jsl     long:`?L166`
    \ 000067 da                   phx
    \ 000068 48                   pha
    \ 000069 b7..                 lda     [.tiny (_Dp+8)],y
    \ 00006b 85..                 sta     dp:.tiny _Dp
    \ 00006d 68                   pla
    \ 00006e fa                   plx
    \ 00006f 18                   clc
    \ 000070 65..                 adc     dp:.tiny _Dp
    \ 000072 9001                 bcc     `?L121`
    \ 000074 e8                   inx
    \ 000075          `?L121`:
    \ 000075 97..                 sta     [.tiny (_Dp+12)],y
    \ 000077 8a                   txa
    \ 000078 a00a00               ldy     ##10
    \ 00007b 97..                 sta     [.tiny (_Dp+12)],y
0104                  
0105                  	// Add to pm->available
0106                  	pmalloc_item_insert(&pm->available, node);
    \ 00007d 22......             jsl     long:`?L156`
    \ 000081 22......             jsl     long:pmalloc_item_insert
0107                  
0108                  	// Merge around current
0109                  	pmalloc_merge(pm, node);
    \ 000085 22......             jsl     long:`?L156`
    \ 000089 22......             jsl     long:pmalloc_merge
    \ 00008d          `?L23`:
0110                  }
    \ 00008d 7a                   ply
    \ 00008e 5c......             jmp     long:`?L6`
0111                  
0112                  void pmalloc_merge(pmalloc_t *pm, pmalloc_item_t __far *node) {
    \ 000000                      .section farcode,text
    \ 000000                      .public pmalloc_merge
    \ 000000          pmalloc_merge:
    \ 000000 d4..                 pei     dp:.tiny (_Dp+8)
    \ 000002 d4..                 pei     dp:.tiny (_Dp+10)
    \ 000004 d4..                 pei     dp:.tiny (_Dp+12)
    \ 000006 d4..                 pei     dp:.tiny (_Dp+14)
    \ 000008 5a                   phy
    \ 000009 5a                   phy
    \ 00000a 5a                   phy
    \ 00000b 5a                   phy
    \ 00000c a5..                 lda     dp:.tiny _Dp
    \ 00000e 8305                 sta     5,s
    \ 000010 a5..                 lda     dp:.tiny (_Dp+2)
    \ 000012 8307                 sta     7,s
    \ 000014 a5..                 lda     dp:.tiny (_Dp+4)
    \ 000016 8301                 sta     1,s
    \ 000018 a5..                 lda     dp:.tiny (_Dp+6)
    \ 00001a 8303                 sta     3,s
0113                  	// Scan backward for contiguous blocks
0114                  	while (node->prev != NULL && (char __far *)node == (char __far *)node->prev + sizeof(pmalloc_item_t) + node->prev->size)
    \ 00001c a303                 lda     3,s
    \ 00001e 85..                 sta     dp:.tiny (_Dp+10)
    \ 000020 a301                 lda     1,s
    \ 000022 85..                 sta     dp:.tiny (_Dp+8)
    \ 000024          `?L31`:
    \ 000024 a7..                 lda     [.tiny (_Dp+8)]
    \ 000026 a00200               ldy     ##2
    \ 000029 17..                 ora     [.tiny (_Dp+8)],y
    \ 00002b f03b                 beq     `?L34`
    \ 00002d b7..                 lda     [.tiny (_Dp+8)],y
    \ 00002f 85..                 sta     dp:.tiny (_Dp+2)
    \ 000031 a7..                 lda     [.tiny (_Dp+8)]
    \ 000033 85..                 sta     dp:.tiny _Dp
    \ 000035 18                   clc
    \ 000036 a5..                 lda     dp:.tiny _Dp
    \ 000038 690a00               adc     ##10
    \ 00003b 85..                 sta     dp:.tiny _Dp
    \ 00003d b7..                 lda     [.tiny (_Dp+8)],y
    \ 00003f 85..                 sta     dp:.tiny (_Dp+6)
    \ 000041 a7..                 lda     [.tiny (_Dp+8)]
    \ 000043 85..                 sta     dp:.tiny (_Dp+4)
    \ 000045 18                   clc
    \ 000046 a5..                 lda     dp:.tiny _Dp
    \ 000048 a00800               ldy     ##8
    \ 00004b 77..                 adc     [.tiny (_Dp+4)],y
    \ 00004d 85..                 sta     dp:.tiny _Dp
    \ 00004f c5..                 cmp     dp:.tiny (_Dp+8)
    \ 000051 d015                 bne     `?L34`
    \ 000053 a5..                 lda     dp:.tiny (_Dp+2)
    \ 000055 c5..                 cmp     dp:.tiny (_Dp+10)
    \ 000057 d00f                 bne     `?L34`
0115                  		node = node->prev;
    \ 000059 a00200               ldy     ##2
    \ 00005c b7..                 lda     [.tiny (_Dp+8)],y
    \ 00005e 85..                 sta     dp:.tiny (_Dp+2)
    \ 000060 a7..                 lda     [.tiny (_Dp+8)]
    \ 000062 22......             jsl     long:`?L158`
    \ 000066 80bc                 bra     `?L31`
    \ 000068          `?L34`:
0116                  
0117                  	// Scan forward and merge free blocks
0118                  	while (node->next == (pmalloc_item_t __far *)((char __far *)node + sizeof(pmalloc_item_t) + node->size)) {
    \ 000068 a5..                 lda     dp:.tiny (_Dp+8)
    \ 00006a 85..                 sta     dp:.tiny _Dp
    \ 00006c a5..                 lda     dp:.tiny (_Dp+10)
    \ 00006e 85..                 sta     dp:.tiny (_Dp+2)
    \ 000070 18                   clc
    \ 000071 a5..                 lda     dp:.tiny _Dp
    \ 000073 690a00               adc     ##10
    \ 000076 85..                 sta     dp:.tiny _Dp
    \ 000078 18                   clc
    \ 000079 a5..                 lda     dp:.tiny _Dp
    \ 00007b a00800               ldy     ##8
    \ 00007e 77..                 adc     [.tiny (_Dp+8)],y
    \ 000080 85..                 sta     dp:.tiny _Dp
    \ 000082 a00400               ldy     ##4
    \ 000085 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000087 c5..                 cmp     dp:.tiny _Dp
    \ 000089 f003                 beq     `?L233`
    \ 00008b 4c....               jmp     .kbank `?L30`
    \ 00008e a00600   `?L233`:    ldy     ##6
    \ 000091 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000093 c5..                 cmp     dp:.tiny (_Dp+2)
    \ 000095 f003                 beq     `?L234`
    \ 000097 4c....               jmp     .kbank `?L30`
    \ 00009a          `?L234`:
0119                  		uint32_t nodesize = node->next->size + sizeof(pmalloc_item_t);
    \ 00009a b7..                 lda     [.tiny (_Dp+8)],y
    \ 00009c 85..                 sta     dp:.tiny (_Dp+2)
    \ 00009e a00400               ldy     ##4
    \ 0000a1 b7..                 lda     [.tiny (_Dp+8)],y
    \ 0000a3 85..                 sta     dp:.tiny _Dp
0120                  		pm->freemem += sizeof(pmalloc_item_t);
    \ 0000a5 22......             jsl     long:`?L175`
    \ 0000a9 77..                 adc     [.tiny _Dp],y
    \ 0000ab a20000               ldx     ##0
    \ 0000ae 86..                 stx     dp:.tiny (_Dp+14)
    \ 0000b0 85..                 sta     dp:.tiny (_Dp+12)
    \ 0000b2 a307                 lda     7,s
    \ 0000b4 85..                 sta     dp:.tiny (_Dp+2)
    \ 0000b6 a305                 lda     5,s
    \ 0000b8 85..                 sta     dp:.tiny _Dp
    \ 0000ba 22......             jsl     long:`?L173`
    \ 0000be 18                   clc
    \ 0000bf 690a00               adc     ##10
    \ 0000c2 9001                 bcc     `?L127`
    \ 0000c4 e8                   inx
    \ 0000c5 da       `?L127`:    phx
    \ 0000c6 48                   pha
    \ 0000c7 a30b                 lda     11,s
    \ 0000c9 85..                 sta     dp:.tiny (_Dp+2)
    \ 0000cb a309                 lda     9,s
    \ 0000cd 85..                 sta     dp:.tiny _Dp
    \ 0000cf 68                   pla
    \ 0000d0 fa                   plx
    \ 0000d1 97..                 sta     [.tiny _Dp],y
    \ 0000d3 8a                   txa
    \ 0000d4 a00a00               ldy     ##10
    \ 0000d7 97..                 sta     [.tiny _Dp],y
0121                  		pmalloc_item_remove(&pm->available, node->next);
    \ 0000d9 a00600               ldy     ##6
    \ 0000dc b7..                 lda     [.tiny (_Dp+8)],y
    \ 0000de 85..                 sta     dp:.tiny (_Dp+6)
    \ 0000e0 a00400               ldy     ##4
    \ 0000e3 b7..                 lda     [.tiny (_Dp+8)],y
    \ 0000e5 85..                 sta     dp:.tiny (_Dp+4)
    \ 0000e7 a307                 lda     7,s
    \ 0000e9 85..                 sta     dp:.tiny (_Dp+2)
    \ 0000eb a305                 lda     5,s
    \ 0000ed 85..                 sta     dp:.tiny _Dp
    \ 0000ef 22......             jsl     long:pmalloc_item_remove
0122                  		pm->totalnodes--;
    \ 0000f3 a307                 lda     7,s
    \ 0000f5 85..                 sta     dp:.tiny (_Dp+2)
    \ 0000f7 a305                 lda     5,s
    \ 0000f9 85..                 sta     dp:.tiny _Dp
    \ 0000fb 22......             jsl     long:`?L174`
    \ 0000ff d001                 bne     `?L130`
    \ 000101 ca                   dex
    \ 000102 3a       `?L130`:    dec     a
    \ 000103 da                   phx
    \ 000104 48                   pha
    \ 000105 a30b                 lda     11,s
    \ 000107 85..                 sta     dp:.tiny (_Dp+2)
    \ 000109 a309                 lda     9,s
    \ 00010b 85..                 sta     dp:.tiny _Dp
    \ 00010d 68                   pla
    \ 00010e fa                   plx
    \ 00010f 97..                 sta     [.tiny _Dp],y
    \ 000111 8a                   txa
    \ 000112 a01200               ldy     ##18
    \ 000115 97..                 sta     [.tiny _Dp],y
0123                  		node->size += nodesize;
    \ 000117 a5..                 lda     dp:.tiny (_Dp+12)
    \ 000119 a00800               ldy     ##8
    \ 00011c 18                   clc
    \ 00011d 77..                 adc     [.tiny (_Dp+8)],y
    \ 00011f 97..                 sta     [.tiny (_Dp+8)],y
    \ 000121 4c....               jmp     .kbank `?L34`
    \ 000124          `?L30`:
0124                  	}
0125                  }
    \ 000124 7a                   ply
    \ 000125 7a                   ply
    \ 000126 7a                   ply
    \ 000127 7a                   ply
    \ 000128 5c......             jmp     long:`?L6`
0126                  
0127                  uint32_t pmalloc_sizeof(pmalloc_t *pm, void __far *ptr) {
    \ 000000                      .section farcode,text
    \ 000000                      .public pmalloc_sizeof
    \ 000000          pmalloc_sizeof:
0128                  	// Get the actual pmalloc_item_t of the block
0129                  	pmalloc_item_t __far *node = (pmalloc_item_t __far *)(ptr - sizeof(pmalloc_item_t));
0130                  
0131                  	// Return its size
0132                  	return node->size;
    \ 000000 a00800               ldy     ##8
    \ 000003 b7..                 lda     [.tiny (_Dp+4)],y
    \ 000005 a20000               ldx     ##0
0133                  }
    \ 000008 6b                   rtl
0134                  
0135                  uint32_t pmalloc_totalmem(pmalloc_t *pm) { return pm->totalmem; }
    \ 000000                      .section farcode,text
    \ 000000                      .public pmalloc_totalmem
    \ 000000          pmalloc_totalmem:
    \ 000000 a00e00               ldy     ##14
    \ 000003 b7..                 lda     [.tiny _Dp],y
    \ 000005 aa                   tax
    \ 000006 a00c00               ldy     ##12
    \ 000009 b7..                 lda     [.tiny _Dp],y
    \ 00000b 6b                   rtl
0136                  uint32_t pmalloc_freemem(pmalloc_t *pm) { return pm->freemem; }
    \ 000000                      .section farcode,text
    \ 000000                      .public pmalloc_freemem
    \ 000000          pmalloc_freemem:
    \ 000000 22......             jsl     long:`?L173`
    \ 000004 6b                   rtl
0137                  uint32_t pmalloc_usedmem(pmalloc_t *pm) { return pm->totalmem - pm->freemem; }
    \ 000000                      .section farcode,text
    \ 000000                      .public pmalloc_usedmem
    \ 000000          pmalloc_usedmem:
    \ 000000 38                   sec
    \ 000001 a00c00               ldy     ##12
    \ 000004 b7..                 lda     [.tiny _Dp],y
    \ 000006 a00800               ldy     ##8
    \ 000009 f7..                 sbc     [.tiny _Dp],y
    \ 00000b 48                   pha
    \ 00000c a00e00               ldy     ##14
    \ 00000f b7..                 lda     [.tiny _Dp],y
    \ 000011 a00a00               ldy     ##10
    \ 000014 f7..                 sbc     [.tiny _Dp],y
    \ 000016 aa                   tax
    \ 000017 68                   pla
    \ 000018 6b                   rtl
0138                  uint32_t pmalloc_overheadmem(pmalloc_t *pm) { return pm->totalnodes * sizeof(pmalloc_item_t); }
    \ 000000                      .section farcode,text
    \ 000000                      .public pmalloc_overheadmem
    \ 000000          pmalloc_overheadmem:
    \ 000000 22......             jsl     long:`?L174`
    \ 000004 86..                 stx     dp:.tiny _Dp
    \ 000006 0a                   asl     a
    \ 000007 26..                 rol     dp:.tiny _Dp
    \ 000009 a6..                 ldx     dp:.tiny _Dp
    \ 00000b 86..                 stx     dp:.tiny (_Dp+2)
    \ 00000d 85..                 sta     dp:.tiny _Dp
    \ 00000f 86..                 stx     dp:.tiny (_Dp+4)
    \ 000011 0a                   asl     a
    \ 000012 26..                 rol     dp:.tiny (_Dp+4)
    \ 000014 0a                   asl     a
    \ 000015 26..                 rol     dp:.tiny (_Dp+4)
    \ 000017 a6..                 ldx     dp:.tiny (_Dp+4)
    \ 000019 18                   clc
    \ 00001a 65..                 adc     dp:.tiny _Dp
    \ 00001c 48                   pha
    \ 00001d 8a                   txa
    \ 00001e 65..                 adc     dp:.tiny (_Dp+2)
    \ 000020 aa                   tax
    \ 000021 68                   pla
    \ 000022 86..                 stx     dp:.tiny (_Dp+2)
    \ 000024 85..                 sta     dp:.tiny _Dp
    \ 000026 a6..                 ldx     dp:.tiny (_Dp+2)
    \ 000028 a5..                 lda     dp:.tiny _Dp
    \ 00002a 6b                   rtl
0139                  
0140                  void pmalloc_item_insert(fp_pmalloc_item_t *root, void __far *ptr)
0141                  {
    \ 000000                      .section farcode,text
    \ 000000                      .public pmalloc_item_insert
    \ 000000          pmalloc_item_insert:
    \ 000000 d4..                 pei     dp:.tiny (_Dp+8)
    \ 000002 d4..                 pei     dp:.tiny (_Dp+10)
0142                  	// No existing root
0143                  	if(*root == NULL) {
    \ 000004 a7..                 lda     [.tiny _Dp]
    \ 000006 a00200               ldy     ##2
    \ 000009 17..                 ora     [.tiny _Dp],y
    \ 00000b d024                 bne     `?L61`
0144                  		*root = (pmalloc_item_t __far *)ptr;
    \ 00000d a5..                 lda     dp:.tiny (_Dp+4)
    \ 00000f 87..                 sta     [.tiny _Dp]
    \ 000011 a5..                 lda     dp:.tiny (_Dp+6)
    \ 000013 97..                 sta     [.tiny _Dp],y
0145                  		(*root)->prev = NULL;
    \ 000015 85..                 sta     dp:.tiny (_Dp+6)
    \ 000017 a7..                 lda     [.tiny _Dp]
    \ 000019 85..                 sta     dp:.tiny (_Dp+4)
    \ 00001b a90000               lda     ##0
    \ 00001e 87..                 sta     [.tiny (_Dp+4)]
    \ 000020 97..                 sta     [.tiny (_Dp+4)],y
0146                  		(*root)->next = NULL;
    \ 000022 b7..                 lda     [.tiny _Dp],y
    \ 000024 85..                 sta     dp:.tiny (_Dp+6)
    \ 000026 a7..                 lda     [.tiny _Dp]
    \ 000028 85..                 sta     dp:.tiny (_Dp+4)
    \ 00002a 22......             jsl     long:`?L169`
0147                  		return;
    \ 00002e 4c....               jmp     .kbank `?L59`
    \ 000031          `?L61`:
0148                  	}
0149                  
0150                  	// Where is the block in relation to the root?
0151                  	if(ptr < (void*)*root) {
    \ 000031 a5..                 lda     dp:.tiny (_Dp+4)
    \ 000033 c7..                 cmp     [.tiny _Dp]
    \ 000035 a5..                 lda     dp:.tiny (_Dp+6)
    \ 000037 f7..                 sbc     [.tiny _Dp],y
    \ 000039 b017                 bcs     `?L64`
0152                  		// New block before root
0153                  		pmalloc_item_t __far *node = (pmalloc_item_t __far *)ptr;
0154                  		pmalloc_item_t *oldroot = *root;
0155                  		oldroot->prev = node;
0156                  		node->next = oldroot;
    \ 00003b 22......             jsl     long:`?L170`
    \ 00003f a5..                 lda     dp:.tiny (_Dp+4)
    \ 000041 87..                 sta     [.tiny (_Dp+8)]
    \ 000043 a5..                 lda     dp:.tiny (_Dp+6)
    \ 000045 97..                 sta     [.tiny (_Dp+8)],y
    \ 000047 a5..                 lda     dp:.tiny (_Dp+8)
    \ 000049 a00400               ldy     ##4
    \ 00004c 97..                 sta     [.tiny (_Dp+4)],y
    \ 00004e a5..                 lda     dp:.tiny (_Dp+10)
    \ 000050 805d                 bra     `?L154`
    \ 000052          `?L64`:
0157                  		*root = node;
0158                  	} else {
0159                  		// New block within or at end of list
0160                  		pmalloc_item_t __far *current = *root;
    \ 000052 22......             jsl     long:`?L170`
    \ 000056          `?L67`:
0161                  		pmalloc_item_t __far *node = (pmalloc_item_t __far *)ptr;
0162                  		
0163                  		// Skip until we find the right place to insert, or the end of the list
0164                  		while(current->next != NULL && node > current->next) current = current->next;
    \ 000056 22......             jsl     long:`?L176`
    \ 00005a f016                 beq     `?L68`
    \ 00005c a00400               ldy     ##4
    \ 00005f b7..                 lda     [.tiny (_Dp+8)],y
    \ 000061 c5..                 cmp     dp:.tiny (_Dp+4)
    \ 000063 a00600               ldy     ##6
    \ 000066 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000068 e5..                 sbc     dp:.tiny (_Dp+6)
    \ 00006a b006                 bcs     `?L68`
    \ 00006c 22......             jsl     long:`?L157`
    \ 000070 80e4                 bra     `?L67`
    \ 000072          `?L68`:
0165                  
0166                  		// We're inserting the block at...
0167                  		if(current->next == NULL) {
    \ 000072 22......             jsl     long:`?L176`
    \ 000076 d014                 bne     `?L70`
0168                  			// The end of list
0169                  			node->prev = current;
0170                  			current->next = node;
    \ 000078 22......             jsl     long:`?L172`
    \ 00007c a5..                 lda     dp:.tiny (_Dp+4)
    \ 00007e a00400               ldy     ##4
    \ 000081 97..                 sta     [.tiny (_Dp+8)],y
    \ 000083 a5..                 lda     dp:.tiny (_Dp+6)
    \ 000085 a00600               ldy     ##6
    \ 000088 97..                 sta     [.tiny (_Dp+8)],y
    \ 00008a 8033                 bra     `?L59`
    \ 00008c          `?L70`:
0171                  		} else {
0172                  			// Somewhere in the middle
0173                  			pmalloc_item_t __far *oldnext = current->next;
    \ 00008c b7..                 lda     [.tiny (_Dp+8)],y
    \ 00008e 85..                 sta     dp:.tiny (_Dp+2)
    \ 000090 a00400               ldy     ##4
    \ 000093 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000095 85..                 sta     dp:.tiny _Dp
0174                  
0175                  			current->next = node;
    \ 000097 a5..                 lda     dp:.tiny (_Dp+4)
    \ 000099 97..                 sta     [.tiny (_Dp+8)],y
    \ 00009b a5..                 lda     dp:.tiny (_Dp+6)
    \ 00009d a00600               ldy     ##6
    \ 0000a0 97..                 sta     [.tiny (_Dp+8)],y
0176                  			node->prev = current;
0177                  			node->next = oldnext;
    \ 0000a2 22......             jsl     long:`?L172`
    \ 0000a6 a5..                 lda     dp:.tiny _Dp
    \ 0000a8 a00400               ldy     ##4
    \ 0000ab 97..                 sta     [.tiny (_Dp+4)],y
    \ 0000ad a5..                 lda     dp:.tiny (_Dp+2)
    \ 0000af a00600   `?L154`:    ldy     ##6
    \ 0000b2 97..                 sta     [.tiny (_Dp+4)],y
0178                  			oldnext->prev = node;
    \ 0000b4 a5..                 lda     dp:.tiny (_Dp+4)
    \ 0000b6 87..                 sta     [.tiny _Dp]
    \ 0000b8 a5..                 lda     dp:.tiny (_Dp+6)
    \ 0000ba a00200               ldy     ##2
    \ 0000bd 97..                 sta     [.tiny _Dp],y
    \ 0000bf          `?L59`:
0179                  		}
0180                  	} 
0181                  }
    \ 0000bf 5c......             jmp     long:`?L75`
0182                  
0183                  void pmalloc_item_remove(fp_pmalloc_item_t *root, pmalloc_item_t __far *node) 
0184                  {
    \ 000000                      .section farcode,text
    \ 000000                      .public pmalloc_item_remove
    \ 000000          pmalloc_item_remove:
    \ 000000 d4..                 pei     dp:.tiny (_Dp+8)
    \ 000002 d4..                 pei     dp:.tiny (_Dp+10)
0185                  	// Remove the node
0186                  	if(node->prev) node->prev->next = node->next;
    \ 000004 a7..                 lda     [.tiny (_Dp+4)]
    \ 000006 a00200               ldy     ##2
    \ 000009 17..                 ora     [.tiny (_Dp+4)],y
    \ 00000b f016                 beq     `?L77`
    \ 00000d b7..                 lda     [.tiny (_Dp+4)],y
    \ 00000f 85..                 sta     dp:.tiny (_Dp+10)
    \ 000011 a7..                 lda     [.tiny (_Dp+4)]
    \ 000013 85..                 sta     dp:.tiny (_Dp+8)
    \ 000015 a00400               ldy     ##4
    \ 000018 b7..                 lda     [.tiny (_Dp+4)],y
    \ 00001a 97..                 sta     [.tiny (_Dp+8)],y
    \ 00001c a00600               ldy     ##6
    \ 00001f b7..                 lda     [.tiny (_Dp+4)],y
    \ 000021 97..                 sta     [.tiny (_Dp+8)],y
    \ 000023          `?L77`:
0187                  	if(node->next) node->next->prev = node->prev;
    \ 000023 a00400               ldy     ##4
    \ 000026 b7..                 lda     [.tiny (_Dp+4)],y
    \ 000028 a00600               ldy     ##6
    \ 00002b 17..                 ora     [.tiny (_Dp+4)],y
    \ 00002d f016                 beq     `?L80`
    \ 00002f b7..                 lda     [.tiny (_Dp+4)],y
    \ 000031 85..                 sta     dp:.tiny (_Dp+10)
    \ 000033 a00400               ldy     ##4
    \ 000036 b7..                 lda     [.tiny (_Dp+4)],y
    \ 000038 85..                 sta     dp:.tiny (_Dp+8)
    \ 00003a a7..                 lda     [.tiny (_Dp+4)]
    \ 00003c 87..                 sta     [.tiny (_Dp+8)]
    \ 00003e a00200               ldy     ##2
    \ 000041 b7..                 lda     [.tiny (_Dp+4)],y
    \ 000043 97..                 sta     [.tiny (_Dp+8)],y
    \ 000045          `?L80`:
0188                  	
0189                  	// Fixup root if the node was root
0190                  	if(node==*root) {
    \ 000045 a7..                 lda     [.tiny _Dp]
    \ 000047 c5..                 cmp     dp:.tiny (_Dp+4)
    \ 000049 d026                 bne     `?L83`
    \ 00004b a00200               ldy     ##2
    \ 00004e b7..                 lda     [.tiny _Dp],y
    \ 000050 c5..                 cmp     dp:.tiny (_Dp+6)
    \ 000052 d01d                 bne     `?L83`
0191                  		if (node->prev) 
    \ 000054 a7..                 lda     [.tiny (_Dp+4)]
    \ 000056 17..                 ora     [.tiny (_Dp+4)],y
    \ 000058 f006                 beq     `?L85`
0192                  			*root = node->prev; 
    \ 00005a a7..                 lda     [.tiny (_Dp+4)]
    \ 00005c 87..                 sta     [.tiny _Dp]
    \ 00005e 800a                 bra     `?L155`
    \ 000060          `?L85`:
0193                  		else 
0194                  			*root = node->next; 
    \ 000060 a00400               ldy     ##4
    \ 000063 b7..                 lda     [.tiny (_Dp+4)],y
    \ 000065 87..                 sta     [.tiny _Dp]
    \ 000067 a00600               ldy     ##6
    \ 00006a          `?L155`:
    \ 00006a b7..                 lda     [.tiny (_Dp+4)],y
    \ 00006c a00200               ldy     ##2
    \ 00006f 97..                 sta     [.tiny _Dp],y
    \ 000071          `?L83`:
0195                  	}
0196                  
0197                  	// Clear the next and previous pointers
0198                  	node->next = NULL;
0199                  	node->prev = NULL;
    \ 000071 22......             jsl     long:`?L169`
    \ 000075 87..                 sta     [.tiny (_Dp+4)]
    \ 000077 a00200               ldy     ##2
    \ 00007a 97..                 sta     [.tiny (_Dp+4)],y
    \ 00007c          `?L75`:
0200                  }
    \ 00007c 7a                   ply
    \ 00007d 84..                 sty     dp:.tiny (_Dp+10)
    \ 00007f 7a                   ply
    \ 000080 84..                 sty     dp:.tiny (_Dp+8)
    \ 000082 6b                   rtl
0201                  
0202                  #ifdef DEBUG
0203                  void pmalloc_dump_stats(pmalloc_t *pm) {
    \ 000000                      .section farcode,text
    \ 000000                      .public pmalloc_dump_stats
    \ 000000          pmalloc_dump_stats:
    \ 000000 d4..                 pei     dp:.tiny (_Dp+8)
    \ 000002 d4..                 pei     dp:.tiny (_Dp+10)
    \ 000004 d4..                 pei     dp:.tiny (_Dp+12)
    \ 000006 d4..                 pei     dp:.tiny (_Dp+14)
    \ 000008 3b                   tsc
    \ 000009 38                   sec
    \ 00000a e92600               sbc     ##38
    \ 00000d 1b                   tcs
    \ 00000e a5..                 lda     dp:.tiny _Dp
    \ 000010 8323                 sta     35,s
    \ 000012 a5..                 lda     dp:.tiny (_Dp+2)
    \ 000014 8325                 sta     37,s
0204                  	printf("---------------------\r");
    \ 000016 a9....               lda     ##.word0 `_StringLiteral_[45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,13]`
    \ 000019 85..                 sta     dp:.tiny _Dp
    \ 00001b a9....               lda     ##.word2 `_StringLiteral_[45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,13]`
    \ 00001e 85..                 sta     dp:.tiny (_Dp+2)
    \ 000020 22......             jsl     long:`?L164`
0205                  	printf(" - freemem: %lu\r", pm->freemem);
    \ 000024 a00a00               ldy     ##10
    \ 000027 b7..                 lda     [.tiny _Dp],y
    \ 000029 48                   pha
    \ 00002a a00800               ldy     ##8
    \ 00002d b7..                 lda     [.tiny _Dp],y
    \ 00002f 48                   pha
    \ 000030 a9....               lda     ##.word0 `_StringLiteral_[32,45,32,102,114,101,101,109,101,109,58,32,37,108,117,13]`
    \ 000033 85..                 sta     dp:.tiny _Dp
    \ 000035 a9....               lda     ##.word2 `_StringLiteral_[32,45,32,102,114,101,101,109,101,109,58,32,37,108,117,13]`
    \ 000038 22......             jsl     long:`?L167`
    \ 00003c 8305                 sta     5,s
0206                  	printf(" - totalmem: %lu\r", pm->totalmem);
    \ 00003e a329                 lda     41,s
    \ 000040 85..                 sta     dp:.tiny (_Dp+2)
    \ 000042 a327                 lda     39,s
    \ 000044 85..                 sta     dp:.tiny _Dp
    \ 000046 a00e00               ldy     ##14
    \ 000049 b7..                 lda     [.tiny _Dp],y
    \ 00004b 48                   pha
    \ 00004c a00c00               ldy     ##12
    \ 00004f b7..                 lda     [.tiny _Dp],y
    \ 000051 48                   pha
    \ 000052 a9....               lda     ##.word0 `_StringLiteral_[32,45,32,116,111,116,97,108,109,101,109,58,32,37,108,117,13]`
    \ 000055 85..                 sta     dp:.tiny _Dp
    \ 000057 a9....               lda     ##.word2 `_StringLiteral_[32,45,32,116,111,116,97,108,109,101,109,58,32,37,108,117,13]`
    \ 00005a 22......             jsl     long:`?L167`
    \ 00005e 8309                 sta     9,s
0207                  	printf(" - totalnodes: %lu (sizeof %d)\r", pm->totalnodes, (int)sizeof(pmalloc_item_t));
    \ 000060 f40a00               pea     ##10
    \ 000063 a32f                 lda     47,s
    \ 000065 85..                 sta     dp:.tiny (_Dp+2)
    \ 000067 a32d                 lda     45,s
    \ 000069 85..                 sta     dp:.tiny _Dp
    \ 00006b a01200               ldy     ##18
    \ 00006e b7..                 lda     [.tiny _Dp],y
    \ 000070 48                   pha
    \ 000071 a01000               ldy     ##16
    \ 000074 b7..                 lda     [.tiny _Dp],y
    \ 000076 48                   pha
    \ 000077 a9....               lda     ##.word0 `_StringLiteral_[32,45,32,116,111,116,97,108,110,111,100,101,115,58,32,37,108,117,32,40,115,105,122,101,111,102,32,37,100,41,13]`
    \ 00007a 85..                 sta     dp:.tiny _Dp
    \ 00007c a9....               lda     ##.word2 `_StringLiteral_[32,45,32,116,111,116,97,108,110,111,100,101,115,58,32,37,108,117,32,40,115,105,122,101,111,102,32,37,100,41,13]`
    \ 00007f 22......             jsl     long:`?L167`
    \ 000083 830f                 sta     15,s
0208                  	printf(" - assigned:\r");
    \ 000085 3b                   tsc
    \ 000086 18                   clc
    \ 000087 690e00               adc     ##14
    \ 00008a 1b                   tcs
    \ 00008b a9....               lda     ##.word0 `_StringLiteral_[32,45,32,97,115,115,105,103,110,101,100,58,13]`
    \ 00008e 85..                 sta     dp:.tiny _Dp
    \ 000090 a9....               lda     ##.word2 `_StringLiteral_[32,45,32,97,115,115,105,103,110,101,100,58,13]`
    \ 000093 85..                 sta     dp:.tiny (_Dp+2)
    \ 000095 22......             jsl     long:`?L164`
0209                  	for(pmalloc_item_t __far * current = pm->assigned; current != NULL; current=current->next) {
    \ 000099 a00600               ldy     ##6
    \ 00009c b7..                 lda     [.tiny _Dp],y
    \ 00009e 85..                 sta     dp:.tiny (_Dp+10)
    \ 0000a0 a00400               ldy     ##4
    \ 0000a3 b7..                 lda     [.tiny _Dp],y
    \ 0000a5 85..                 sta     dp:.tiny (_Dp+8)
    \ 0000a7          `?L92`:
    \ 0000a7 a5..                 lda     dp:.tiny (_Dp+8)
    \ 0000a9 05..                 ora     dp:.tiny (_Dp+10)
    \ 0000ab f003                 beq     `?L235`
    \ 0000ad 4c....               jmp     .kbank `?L91`
    \ 0000b0          `?L235`:
0210                  		printf("  - (%08llx) %08llx- %08llx-size:%lld (%u sys, %hu usr)\r", (unsigned long long)(char __far *)current, (unsigned long long)(char __far *)current + sizeof(pmalloc_item_t), (unsigned long long)(char __far *)current + current->size + sizeof(pmalloc_item_t), (unsigned long long)(current->size + sizeof(pmalloc_item_t)), sizeof(pmalloc_item_t), current->size);
0211                  	} 
0212                  	printf(" - available:\r");
    \ 0000b0 a9....               lda     ##.word0 `_StringLiteral_[32,45,32,97,118,97,105,108,97,98,108,101,58,13]`
    \ 0000b3 85..                 sta     dp:.tiny _Dp
    \ 0000b5 a9....               lda     ##.word2 `_StringLiteral_[32,45,32,97,118,97,105,108,97,98,108,101,58,13]`
    \ 0000b8 85..                 sta     dp:.tiny (_Dp+2)
    \ 0000ba 22......             jsl     long:`?L164`
0213                  	for(pmalloc_item_t __far * current = pm->available; current != NULL; current=current->next) {
    \ 0000be a00200               ldy     ##2
    \ 0000c1 22......             jsl     long:`?L170`
    \ 0000c5          `?L96`:
    \ 0000c5 a5..                 lda     dp:.tiny (_Dp+8)
    \ 0000c7 05..                 ora     dp:.tiny (_Dp+10)
    \ 0000c9 d01e                 bne     `?L95`
0214                  		printf("  - (%08llx) %08llx->%08llx-size:%lld (%u sys, %hu usr)\r", (unsigned long long)(char __far *)current, (unsigned long long)(char __far *)current + sizeof(pmalloc_item_t), (unsigned long long)(char __far *)current + current->size + sizeof(pmalloc_item_t), (unsigned long long)(current->size + sizeof(pmalloc_item_t)), sizeof(pmalloc_item_t), current->size);
0215                  	} 
0216                  
0217                  	printf("---------------------\r");
    \ 0000cb a9....               lda     ##.word0 `_StringLiteral_[45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,13]`
    \ 0000ce 85..                 sta     dp:.tiny _Dp
    \ 0000d0 a9....               lda     ##.word2 `_StringLiteral_[45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,13]`
    \ 0000d3 85..                 sta     dp:.tiny (_Dp+2)
    \ 0000d5 22......             jsl     long:printf
0218                  }
    \ 0000d9 3b                   tsc
    \ 0000da 18                   clc
    \ 0000db 692600               adc     ##38
    \ 0000de 1b                   tcs
    \ 0000df 7a                   ply
    \ 0000e0 84..                 sty     dp:.tiny (_Dp+14)
    \ 0000e2 7a                   ply
    \ 0000e3 84..                 sty     dp:.tiny (_Dp+12)
    \ 0000e5 5c......             jmp     long:`?L75`
    \ 0000e9          `?L95`:
    \ 0000e9 a5..                 lda     dp:.tiny (_Dp+10)
    \ 0000eb aa                   tax
    \ 0000ec a5..                 lda     dp:.tiny (_Dp+8)
    \ 0000ee 8303                 sta     3,s
    \ 0000f0 8a                   txa
    \ 0000f1 8305                 sta     5,s
    \ 0000f3 a90000               lda     ##0
    \ 0000f6 8307                 sta     7,s
    \ 0000f8 8309                 sta     9,s
    \ 0000fa a5..                 lda     dp:.tiny (_Dp+10)
    \ 0000fc aa                   tax
    \ 0000fd a5..                 lda     dp:.tiny (_Dp+8)
    \ 0000ff 830b                 sta     11,s
    \ 000101 8a                   txa
    \ 000102 830d                 sta     13,s
    \ 000104 a90000               lda     ##0
    \ 000107 830f                 sta     15,s
    \ 000109 8311                 sta     17,s
    \ 00010b 3b                   tsc
    \ 00010c 22......             jsl     long:`?L171`
    \ 000110 3b                   tsc
    \ 000111 18                   clc
    \ 000112 22......             jsl     long:`?L162`
    \ 000116          `?L140`:
    \ 000116 22......             jsl     long:`?L160`
    \ 00011a 10fa                 bpl     `?L140`
    \ 00011c a5..                 lda     dp:.tiny (_Dp+10)
    \ 00011e aa                   tax
    \ 00011f a5..                 lda     dp:.tiny (_Dp+8)
    \ 000121 8313                 sta     19,s
    \ 000123 8a                   txa
    \ 000124 8315                 sta     21,s
    \ 000126 a90000               lda     ##0
    \ 000129 8317                 sta     23,s
    \ 00012b 8319                 sta     25,s
    \ 00012d a00800               ldy     ##8
    \ 000130 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000132 831b                 sta     27,s
    \ 000134 a90000               lda     ##0
    \ 000137 831d                 sta     29,s
    \ 000139 831f                 sta     31,s
    \ 00013b 8321                 sta     33,s
    \ 00013d 3b                   tsc
    \ 00013e 22......             jsl     long:`?L161`
    \ 000142 3b                   tsc
    \ 000143 18                   clc
    \ 000144 691300               adc     ##19
    \ 000147 86..                 stx     dp:.tiny (_Dp+6)
    \ 000149 85..                 sta     dp:.tiny (_Dp+4)
    \ 00014b 3b                   tsc
    \ 00014c 18                   clc
    \ 00014d 22......             jsl     long:`?L168`
    \ 000151          `?L142`:
    \ 000151 22......             jsl     long:`?L160`
    \ 000155 10fa                 bpl     `?L142`
    \ 000157 3b                   tsc
    \ 000158 22......             jsl     long:`?L161`
    \ 00015c 3b                   tsc
    \ 00015d 18                   clc
    \ 00015e 22......             jsl     long:`?L163`
    \ 000162          `?L144`:
    \ 000162 22......             jsl     long:`?L160`
    \ 000166 10fa                 bpl     `?L144`
    \ 000168 22......             jsl     long:`?L175`
    \ 00016c 77..                 adc     [.tiny (_Dp+8)],y
    \ 00016e 831b                 sta     27,s
    \ 000170 a90000               lda     ##0
    \ 000173 831d                 sta     29,s
    \ 000175 831f                 sta     31,s
    \ 000177 8321                 sta     33,s
    \ 000179 b7..                 lda     [.tiny (_Dp+8)],y
    \ 00017b 48                   pha
    \ 00017c f40a00               pea     ##10
    \ 00017f 3b                   tsc
    \ 000180 18                   clc
    \ 000181 691f00               adc     ##31
    \ 000184 a20000               ldx     ##0
    \ 000187 da                   phx
    \ 000188 48                   pha
    \ 000189 3b                   tsc
    \ 00018a 18                   clc
    \ 00018b 691b00               adc     ##27
    \ 00018e da                   phx
    \ 00018f 48                   pha
    \ 000190 3b                   tsc
    \ 000191 18                   clc
    \ 000192 691700               adc     ##23
    \ 000195 da                   phx
    \ 000196 48                   pha
    \ 000197 3b                   tsc
    \ 000198 18                   clc
    \ 000199 691300               adc     ##19
    \ 00019c da                   phx
    \ 00019d 48                   pha
    \ 00019e a9....               lda     ##.word0 `_StringLiteral_[32,32,45,32,40,37,48,56,108,108,120,41,32,37,48,56,108,108,120,45,62,37,48,56,108,108,120,45,115,105,122,101,58,37,108,108,100,32,40,37,117,32,115,121,115,44,32,37,104,117,32,117,115,114,41,13]`
    \ 0001a1 85..                 sta     dp:.tiny _Dp
    \ 0001a3 a9....               lda     ##.word2 `_StringLiteral_[32,32,45,32,40,37,48,56,108,108,120,41,32,37,48,56,108,108,120,45,62,37,48,56,108,108,120,45,115,105,122,101,58,37,108,108,100,32,40,37,117,32,115,121,115,44,32,37,104,117,32,117,115,114,41,13]`
    \ 0001a6 22......             jsl     long:`?L167`
    \ 0001aa 8315                 sta     21,s
    \ 0001ac 3b                   tsc
    \ 0001ad 18                   clc
    \ 0001ae 691400               adc     ##20
    \ 0001b1 1b                   tcs
    \ 0001b2 a00600               ldy     ##6
    \ 0001b5 22......             jsl     long:`?L157`
    \ 0001b9 4c....               jmp     .kbank `?L96`
    \ 0001bc          `?L91`:
    \ 0001bc a5..                 lda     dp:.tiny (_Dp+10)
    \ 0001be aa                   tax
    \ 0001bf a5..                 lda     dp:.tiny (_Dp+8)
    \ 0001c1 8303                 sta     3,s
    \ 0001c3 8a                   txa
    \ 0001c4 8305                 sta     5,s
    \ 0001c6 a90000               lda     ##0
    \ 0001c9 8307                 sta     7,s
    \ 0001cb 8309                 sta     9,s
    \ 0001cd a5..                 lda     dp:.tiny (_Dp+10)
    \ 0001cf aa                   tax
    \ 0001d0 a5..                 lda     dp:.tiny (_Dp+8)
    \ 0001d2 830b                 sta     11,s
    \ 0001d4 8a                   txa
    \ 0001d5 830d                 sta     13,s
    \ 0001d7 a90000               lda     ##0
    \ 0001da 830f                 sta     15,s
    \ 0001dc 8311                 sta     17,s
    \ 0001de 3b                   tsc
    \ 0001df 22......             jsl     long:`?L171`
    \ 0001e3 3b                   tsc
    \ 0001e4 18                   clc
    \ 0001e5 22......             jsl     long:`?L162`
    \ 0001e9          `?L147`:
    \ 0001e9 22......             jsl     long:`?L160`
    \ 0001ed 10fa                 bpl     `?L147`
    \ 0001ef a5..                 lda     dp:.tiny (_Dp+10)
    \ 0001f1 aa                   tax
    \ 0001f2 a5..                 lda     dp:.tiny (_Dp+8)
    \ 0001f4 8313                 sta     19,s
    \ 0001f6 8a                   txa
    \ 0001f7 8315                 sta     21,s
    \ 0001f9 a90000               lda     ##0
    \ 0001fc 8317                 sta     23,s
    \ 0001fe 8319                 sta     25,s
    \ 000200 a00800               ldy     ##8
    \ 000203 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000205 831b                 sta     27,s
    \ 000207 a90000               lda     ##0
    \ 00020a 831d                 sta     29,s
    \ 00020c 831f                 sta     31,s
    \ 00020e 8321                 sta     33,s
    \ 000210 3b                   tsc
    \ 000211 22......             jsl     long:`?L161`
    \ 000215 3b                   tsc
    \ 000216 18                   clc
    \ 000217 691300               adc     ##19
    \ 00021a 86..                 stx     dp:.tiny (_Dp+6)
    \ 00021c 85..                 sta     dp:.tiny (_Dp+4)
    \ 00021e 3b                   tsc
    \ 00021f 18                   clc
    \ 000220 22......             jsl     long:`?L168`
    \ 000224          `?L149`:
    \ 000224 22......             jsl     long:`?L160`
    \ 000228 10fa                 bpl     `?L149`
    \ 00022a 3b                   tsc
    \ 00022b 22......             jsl     long:`?L161`
    \ 00022f 3b                   tsc
    \ 000230 18                   clc
    \ 000231 22......             jsl     long:`?L163`
    \ 000235          `?L151`:
    \ 000235 22......             jsl     long:`?L160`
    \ 000239 10fa                 bpl     `?L151`
    \ 00023b 22......             jsl     long:`?L175`
    \ 00023f 77..                 adc     [.tiny (_Dp+8)],y
    \ 000241 831b                 sta     27,s
    \ 000243 a90000               lda     ##0
    \ 000246 831d                 sta     29,s
    \ 000248 831f                 sta     31,s
    \ 00024a 8321                 sta     33,s
    \ 00024c b7..                 lda     [.tiny (_Dp+8)],y
    \ 00024e 48                   pha
    \ 00024f f40a00               pea     ##10
    \ 000252 3b                   tsc
    \ 000253 18                   clc
    \ 000254 691f00               adc     ##31
    \ 000257 a20000               ldx     ##0
    \ 00025a da                   phx
    \ 00025b 48                   pha
    \ 00025c 3b                   tsc
    \ 00025d 18                   clc
    \ 00025e 691b00               adc     ##27
    \ 000261 da                   phx
    \ 000262 48                   pha
    \ 000263 3b                   tsc
    \ 000264 18                   clc
    \ 000265 691700               adc     ##23
    \ 000268 da                   phx
    \ 000269 48                   pha
    \ 00026a 3b                   tsc
    \ 00026b 18                   clc
    \ 00026c 691300               adc     ##19
    \ 00026f da                   phx
    \ 000270 48                   pha
    \ 000271 a9....               lda     ##.word0 `_StringLiteral_[32,32,45,32,40,37,48,56,108,108,120,41,32,37,48,56,108,108,120,45,32,37,48,56,108,108,120,45,115,105,122,101,58,37,108,108,100,32,40,37,117,32,115,121,115,44,32,37,104,117,32,117,115,114,41,13]`
    \ 000274 85..                 sta     dp:.tiny _Dp
    \ 000276 a9....               lda     ##.word2 `_StringLiteral_[32,32,45,32,40,37,48,56,108,108,120,41,32,37,48,56,108,108,120,45,32,37,48,56,108,108,120,45,115,105,122,101,58,37,108,108,100,32,40,37,117,32,115,121,115,44,32,37,104,117,32,117,115,114,41,13]`
    \ 000279 22......             jsl     long:`?L167`
    \ 00027d 8315                 sta     21,s
    \ 00027f 3b                   tsc
    \ 000280 18                   clc
    \ 000281 691400               adc     ##20
    \ 000284 1b                   tcs
    \ 000285 a00600               ldy     ##6
    \ 000288 22......             jsl     long:`?L157`
    \ 00028c 4c....               jmp     .kbank `?L92`
0219                  #endif
    \ 000000                      .section farcode,text
    \ 000000          `?L156`:
    \ 000000 a5..                 lda     dp:.tiny (_Dp+8)
    \ 000002 85..                 sta     dp:.tiny (_Dp+4)
    \ 000004 a5..                 lda     dp:.tiny (_Dp+10)
    \ 000006 85..                 sta     dp:.tiny (_Dp+6)
    \ 000008 a5..                 lda     dp:.tiny (_Dp+12)
    \ 00000a 85..                 sta     dp:.tiny _Dp
    \ 00000c a5..                 lda     dp:.tiny (_Dp+14)
    \ 00000e 85..                 sta     dp:.tiny (_Dp+2)
    \ 000010 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000          `?L157`:
    \ 000000 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000002 85..                 sta     dp:.tiny (_Dp+2)
    \ 000004 a00400               ldy     ##4
    \ 000007 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000009          `?L158`:
    \ 000009 85..                 sta     dp:.tiny _Dp
    \ 00000b          `?L159`:
    \ 00000b 85..                 sta     dp:.tiny (_Dp+8)
    \ 00000d a5..                 lda     dp:.tiny (_Dp+2)
    \ 00000f 85..                 sta     dp:.tiny (_Dp+10)
    \ 000011 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000          `?L160`:
    \ 000000 b7..                 lda     [.tiny (_Dp+4)],y
    \ 000002 77..                 adc     [.tiny (_Dp+12)],y
    \ 000004 97..                 sta     [.tiny _Dp],y
    \ 000006 c8                   iny
    \ 000007 c8                   iny
    \ 000008 ca                   dex
    \ 000009 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000 18       `?L161`:    clc
    \ 000001 691300               adc     ##19
    \ 000004 a20000               ldx     ##0
    \ 000007 86..                 stx     dp:.tiny (_Dp+2)
    \ 000009 85..                 sta     dp:.tiny _Dp
    \ 00000b 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000 690b00   `?L162`:    adc     ##11
    \ 000003 86..                 stx     dp:.tiny (_Dp+6)
    \ 000005 85..                 sta     dp:.tiny (_Dp+4)
    \ 000007 a9....               lda     ##.word0 _Const_000000000000000a
    \ 00000a 85..                 sta     dp:.tiny (_Dp+12)
    \ 00000c a9....               lda     ##.word2 _Const_000000000000000a
    \ 00000f 85..                 sta     dp:.tiny (_Dp+14)
    \ 000011 a20300               ldx     ##3
    \ 000014 a00000               ldy     ##0
    \ 000017 18                   clc
    \ 000018 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000 691300   `?L163`:    adc     ##19
    \ 000003 86..                 stx     dp:.tiny (_Dp+6)
    \ 000005 85..                 sta     dp:.tiny (_Dp+4)
    \ 000007 a9....               lda     ##.word0 _Const_000000000000000a
    \ 00000a 85..                 sta     dp:.tiny (_Dp+12)
    \ 00000c a9....               lda     ##.word2 _Const_000000000000000a
    \ 00000f 85..                 sta     dp:.tiny (_Dp+14)
    \ 000011 a20300               ldx     ##3
    \ 000014 a00000               ldy     ##0
    \ 000017 18                   clc
    \ 000018 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000          `?L164`:
    \ 000000 22......             jsl     long:printf
    \ 000004 a328                 lda     40,s
    \ 000006 85..                 sta     dp:.tiny (_Dp+2)
    \ 000008 a326                 lda     38,s
    \ 00000a 85..                 sta     dp:.tiny _Dp
    \ 00000c 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000 a00a00   `?L166`:    ldy     ##10
    \ 000003 b7..                 lda     [.tiny (_Dp+12)],y
    \ 000005 aa                   tax
    \ 000006 a00800               ldy     ##8
    \ 000009 b7..                 lda     [.tiny (_Dp+12)],y
    \ 00000b 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000          `?L167`:
    \ 000000 85..                 sta     dp:.tiny (_Dp+2)
    \ 000002 5c......             jmp     long:printf
    \ 000000                      .section farcode,text
    \ 000000 691b00   `?L168`:    adc     ##27
    \ 000003 86..                 stx     dp:.tiny (_Dp+14)
    \ 000005 85..                 sta     dp:.tiny (_Dp+12)
    \ 000007 a20300               ldx     ##3
    \ 00000a a00000               ldy     ##0
    \ 00000d 18                   clc
    \ 00000e 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000 a90000   `?L169`:    lda     ##0
    \ 000003 a00400               ldy     ##4
    \ 000006 97..                 sta     [.tiny (_Dp+4)],y
    \ 000008 a00600               ldy     ##6
    \ 00000b 97..                 sta     [.tiny (_Dp+4)],y
    \ 00000d 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000          `?L170`:
    \ 000000 b7..                 lda     [.tiny _Dp],y
    \ 000002 85..                 sta     dp:.tiny (_Dp+10)
    \ 000004 a7..                 lda     [.tiny _Dp]
    \ 000006 85..                 sta     dp:.tiny (_Dp+8)
    \ 000008 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000 18       `?L171`:    clc
    \ 000001 690b00               adc     ##11
    \ 000004 a20000               ldx     ##0
    \ 000007 86..                 stx     dp:.tiny (_Dp+2)
    \ 000009 85..                 sta     dp:.tiny _Dp
    \ 00000b 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000          `?L172`:
    \ 000000 a5..                 lda     dp:.tiny (_Dp+8)
    \ 000002 87..                 sta     [.tiny (_Dp+4)]
    \ 000004 a5..                 lda     dp:.tiny (_Dp+10)
    \ 000006 a00200               ldy     ##2
    \ 000009 97..                 sta     [.tiny (_Dp+4)],y
    \ 00000b 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000 a00a00   `?L173`:    ldy     ##10
    \ 000003 b7..                 lda     [.tiny _Dp],y
    \ 000005 aa                   tax
    \ 000006 a00800               ldy     ##8
    \ 000009 b7..                 lda     [.tiny _Dp],y
    \ 00000b 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000 a01200   `?L174`:    ldy     ##18
    \ 000003 b7..                 lda     [.tiny _Dp],y
    \ 000005 aa                   tax
    \ 000006 a01000               ldy     ##16
    \ 000009 b7..                 lda     [.tiny _Dp],y
    \ 00000b 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000 a90a00   `?L175`:    lda     ##10
    \ 000003 18                   clc
    \ 000004 a00800               ldy     ##8
    \ 000007 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000 a00400   `?L176`:    ldy     ##4
    \ 000003 b7..                 lda     [.tiny (_Dp+8)],y
    \ 000005 a00600               ldy     ##6
    \ 000008 17..                 ora     [.tiny (_Dp+8)],y
    \ 00000a 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000 a00400   `?L177`:    ldy     ##4
    \ 000003 97..                 sta     [.tiny (_Dp+8)],y
    \ 000005 a00600               ldy     ##6
    \ 000008 97..                 sta     [.tiny (_Dp+8)],y
    \ 00000a 6b                   rtl
    \ 000000                      .section farcode,text
    \ 000000 a306     `?L178`:    lda     6,s
    \ 000002 85..                 sta     dp:.tiny (_Dp+6)
    \ 000004 a304                 lda     4,s
    \ 000006 85..                 sta     dp:.tiny (_Dp+4)
    \ 000008 a5..                 lda     dp:.tiny (_Dp+12)
    \ 00000a 6b                   rtl
    \ 000000                      .section cfar,rodata
    \ 000000                      .pubweak _Const_000000000000000a
    \ 000000          _Const_000000000000000a:
    \ 000000 0a000000             .quad   10
    \ 000004 00000000
    \ 000000                      .section cfar,rodata
    \ 000000                      .pubweak `_StringLiteral_[32,32,45,32,40,37,48,56,108,108,120,41,32,37,48,56,108,108,120,45,32,37,48,56,108,108,120,45,115,105,122,101,58,37,108,108,100,32,40,37,117,32,115,121,115,44,32,37,104,117,32,117,115,114,41,13]`
    \ 000000          `_StringLiteral_[32,32,45,32,40,37,48,56,108,108,120,41,32,37,48,56,108,108,120,45,32,37,48,56,108,108,120,45,115,105,122,101,58,37,108,108,100,32,40,37,117,32,115,121,115,44,32,37,104,117,32,117,115,114,41,13]`:
    \ 000000 20202d20             .byte   32,32,45,32,40,37,48,56,108,108,120,41,32,37,48,56,108,108,120,45,32,37,48,56,108,108,120,45,115,105,122,101,58,37,108,108,100,32,40,37,117,32,115,121,115,44,32,37,104,117,32,117,115,114,41,13,0
    \ 000004 28253038
    \ 000008 6c6c7829
    \ 00000c 20253038
    \ 000010 6c6c782d
    \ 000014 20253038
    \ 000018 6c6c782d
    \ 00001c 73697a65
    \ 000020 3a256c6c
    \ 000024 64202825
    \ 000028 75207379
    \ 00002c 732c2025
    \ 000030 68752075
    \ 000034 7372290d
    \ 000038 00
    \ 000000                      .section cfar,rodata
    \ 000000                      .pubweak `_StringLiteral_[32,32,45,32,40,37,48,56,108,108,120,41,32,37,48,56,108,108,120,45,62,37,48,56,108,108,120,45,115,105,122,101,58,37,108,108,100,32,40,37,117,32,115,121,115,44,32,37,104,117,32,117,115,114,41,13]`
    \ 000000          `_StringLiteral_[32,32,45,32,40,37,48,56,108,108,120,41,32,37,48,56,108,108,120,45,62,37,48,56,108,108,120,45,115,105,122,101,58,37,108,108,100,32,40,37,117,32,115,121,115,44,32,37,104,117,32,117,115,114,41,13]`:
    \ 000000 20202d20             .byte   32,32,45,32,40,37,48,56,108,108,120,41,32,37,48,56,108,108,120,45,62,37,48,56,108,108,120,45,115,105,122,101,58,37,108,108,100,32,40,37,117,32,115,121,115,44,32,37,104,117,32,117,115,114,41,13,0
    \ 000004 28253038
    \ 000008 6c6c7829
    \ 00000c 20253038
    \ 000010 6c6c782d
    \ 000014 3e253038
    \ 000018 6c6c782d
    \ 00001c 73697a65
    \ 000020 3a256c6c
    \ 000024 64202825
    \ 000028 75207379
    \ 00002c 732c2025
    \ 000030 68752075
    \ 000034 7372290d
    \ 000038 00
    \ 000000                      .section cfar,rodata
    \ 000000                      .pubweak `_StringLiteral_[32,45,32,97,115,115,105,103,110,101,100,58,13]`
    \ 000000          `_StringLiteral_[32,45,32,97,115,115,105,103,110,101,100,58,13]`:
    \ 000000 202d2061             .byte   32,45,32,97,115,115,105,103,110,101,100,58,13,0
    \ 000004 73736967
    \ 000008 6e65643a
    \ 00000c 0d00
    \ 000000                      .section cfar,rodata
    \ 000000                      .pubweak `_StringLiteral_[32,45,32,97,118,97,105,108,97,98,108,101,58,13]`
    \ 000000          `_StringLiteral_[32,45,32,97,118,97,105,108,97,98,108,101,58,13]`:
    \ 000000 202d2061             .byte   32,45,32,97,118,97,105,108,97,98,108,101,58,13,0
    \ 000004 7661696c
    \ 000008 61626c65
    \ 00000c 3a0d00
    \ 000000                      .section cfar,rodata
    \ 000000                      .pubweak `_StringLiteral_[32,45,32,102,114,101,101,109,101,109,58,32,37,108,117,13]`
    \ 000000          `_StringLiteral_[32,45,32,102,114,101,101,109,101,109,58,32,37,108,117,13]`:
    \ 000000 202d2066             .byte   32,45,32,102,114,101,101,109,101,109,58,32,37,108,117,13,0
    \ 000004 7265656d
    \ 000008 656d3a20
    \ 00000c 256c750d
    \ 000010 00
    \ 000000                      .section cfar,rodata
    \ 000000                      .pubweak `_StringLiteral_[32,45,32,116,111,116,97,108,109,101,109,58,32,37,108,117,13]`
    \ 000000          `_StringLiteral_[32,45,32,116,111,116,97,108,109,101,109,58,32,37,108,117,13]`:
    \ 000000 202d2074             .byte   32,45,32,116,111,116,97,108,109,101,109,58,32,37,108,117,13,0
    \ 000004 6f74616c
    \ 000008 6d656d3a
    \ 00000c 20256c75
    \ 000010 0d00
    \ 000000                      .section cfar,rodata
    \ 000000                      .pubweak `_StringLiteral_[32,45,32,116,111,116,97,108,110,111,100,101,115,58,32,37,108,117,32,40,115,105,122,101,111,102,32,37,100,41,13]`
    \ 000000          `_StringLiteral_[32,45,32,116,111,116,97,108,110,111,100,101,115,58,32,37,108,117,32,40,115,105,122,101,111,102,32,37,100,41,13]`:
    \ 000000 202d2074             .byte   32,45,32,116,111,116,97,108,110,111,100,101,115,58,32,37,108,117,32,40,115,105,122,101,111,102,32,37,100,41,13,0
    \ 000004 6f74616c
    \ 000008 6e6f6465
    \ 00000c 733a2025
    \ 000010 6c752028
    \ 000014 73697a65
    \ 000018 6f662025
    \ 00001c 64290d00
    \ 000000                      .section cfar,rodata
    \ 000000                      .pubweak `_StringLiteral_[45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,13]`
    \ 000000          `_StringLiteral_[45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,13]`:
    \ 000000 2d2d2d2d             .byte   45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,13,0
    \ 000004 2d2d2d2d
    \ 000008 2d2d2d2d
    \ 00000c 2d2d2d2d
    \ 000010 2d2d2d2d
    \ 000014 2d0d00
    \ 000000                      .section cfar,rodata
    \ 000000                      .pubweak `_StringLiteral_[110,111,100,101,32,61,32,37,112,13]`
    \ 000000          `_StringLiteral_[110,111,100,101,32,61,32,37,112,13]`:
    \ 000000 6e6f6465             .byte   110,111,100,101,32,61,32,37,112,13,0
    \ 000004 203d2025
    \ 000008 700d00
    \ 000000                      .section cfar,rodata
    \ 000000                      .pubweak `_StringLiteral_[112,109,97,108,108,111,99,58,32,68,69,66,85,71,32,69,110,97,98,108,101,100,13]`
    \ 000000          `_StringLiteral_[112,109,97,108,108,111,99,58,32,68,69,66,85,71,32,69,110,97,98,108,101,100,13]`:
    \ 000000 706d616c             .byte   112,109,97,108,108,111,99,58,32,68,69,66,85,71,32,69,110,97,98,108,101,100,13,0
    \ 000004 6c6f633a
    \ 000008 20444542
    \ 00000c 55472045
    \ 000010 6e61626c
    \ 000014 65640d00
    \ 000000                      .section cfar,rodata
    \ 000000                      .pubweak `_StringLiteral_[112,116,114,32,32,61,32,37,112,13]`
    \ 000000          `_StringLiteral_[112,116,114,32,32,61,32,37,112,13]`:
    \ 000000 70747220             .byte   112,116,114,32,32,61,32,37,112,13,0
    \ 000004 203d2025
    \ 000008 700d00

##########################
#                        #
# Memory sizes (decimal) #
#                        #
##########################

Executable        (Text): 2292 bytes
Constant   __far        :  287 bytes
